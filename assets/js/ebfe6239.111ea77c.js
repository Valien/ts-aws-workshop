"use strict";(self.webpackChunkts_aws_workshop=self.webpackChunkts_aws_workshop||[]).push([[841],{7629:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>r});const n=JSON.parse('{"id":"tutorial-basics/acls","title":"ACLs!","description":"The power of Tailscale is handled through it\'s robust policy engine and powered by fully customisable ACLs (Access Control Lists).  Let\'s dig into the ACL section and","source":"@site/docs/tutorial-basics/acls.mdx","sourceDirName":"tutorial-basics","slug":"/tutorial-basics/acls","permalink":"/ts-aws-workshop/tutorial-basics/acls","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Access with Tailscale","permalink":"/ts-aws-workshop/tutorial-basics/access-vm"},"next":{"title":"Cleanup","permalink":"/ts-aws-workshop/tutorial-basics/cleanup"}}');var a=t(4848),i=t(8453);const o={sidebar_position:6},l="ACLs!",c={},r=[{value:"Groups",id:"groups",level:3},{value:"Tags",id:"tags",level:3},{value:"ACLs",id:"acls-1",level:3},{value:"SSH",id:"ssh",level:3},{value:"Tests",id:"tests",level:3},{value:"ACL Documentation and Examples",id:"acl-documentation-and-examples",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"acls",children:"ACLs!"})}),"\n",(0,a.jsx)(s.p,{children:"The power of Tailscale is handled through it's robust policy engine and powered by fully customisable ACLs (Access Control Lists).  Let's dig into the ACL section and\ntake a look at the current ACLs that your tailnet has by default."}),"\n",(0,a.jsxs)(s.p,{children:["If you haven't already, go ahead and click the ",(0,a.jsx)(s.strong,{children:"Access controls"})," tab and you should be see a page that looks like the following:"]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"VM Details",src:t(2372).A+"",width:"1139",height:"813"})}),"\n",(0,a.jsxs)(s.p,{children:["Tailscale is ",(0,a.jsx)(s.code,{children:"deny"})," by default so only traffic that is permitted is allowed to traverse the network. The default ACLs are pretty permissive because it would be bad for you to be locked out when you\nfirst launch Tailscale. But as you build out your network you will want to start to add more ACLs to segment and break up your network into logical and more restrictive sections."]}),"\n",(0,a.jsx)(s.p,{children:"Let's take a look at some of the details here."}),"\n",(0,a.jsx)(s.admonition,{type:"info",children:(0,a.jsx)(s.p,{children:"This workshop is just scratching the surface of what you can do with ACLs. See the links at the bottom of this page for more ACL examples."})}),"\n",(0,a.jsx)(s.admonition,{type:"tip",children:(0,a.jsxs)(s.p,{children:["If you mess up your default ACL in this workshop, you can copy it from here - ",(0,a.jsx)(s.a,{href:"https://tailscale.com/kb/1192/acl-samples#allow-all-default-acl",children:"https://tailscale.com/kb/1192/acl-samples#allow-all-default-acl"})]})}),"\n",(0,a.jsx)(s.h3,{id:"groups",children:"Groups"}),"\n",(0,a.jsx)(s.p,{children:"Groups are way to create groups of users that you can then use to assign ACLs versus assigning ACLs to each user indivdually."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:'\t// Declare static groups of users. Use autogroups for all users or users with a specific role.\n\t "groups": {\n\t  \t"group:example": ["alice@example.com", "bob@example.com"],\n\t },\n'})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://tailscale.com/kb/1192/acl-samples#restrict-based-on-group",children:"Groups ACL examples"})}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"tags",children:"Tags"}),"\n",(0,a.jsx)(s.p,{children:"Tags are a powerful feature that helps authenticate and identify non-user devices. You can use ACLs to manage permissions to devices based on their tags."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:'\t// Define the tags which can be applied to devices and by which users.\n\t "tagOwners": {\n\t  \t"tag:example": ["autogroup:admin"],\n\t },\n'})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://tailscale.com/kb/1068/tags",children:"Tags docs"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://tailscale.com/kb/1192/acl-samples#restrict-based-on-purpose-tags",children:"Tags ACL examples"})}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"acls-1",children:"ACLs"}),"\n",(0,a.jsxs)(s.p,{children:["Where all the permissions are at! This section is where you detail who can see and access what. The default ACL allows any users to see any device (the ",(0,a.jsx)(s.code,{children:"*"})," in both ",(0,a.jsx)(s.code,{children:"src"})," and ",(0,a.jsx)(s.code,{children:"dst"}),")."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:'\t// Define access control lists for users, groups, autogroups, tags,\n\t// Tailscale IP addresses, and subnet ranges.\n\t"acls": [\n\t\t// Allow all connections.\n\t\t// Comment this section out if you want to define specific restrictions.\n\t\t{"action": "accept", "src": ["*"], "dst": ["*:*"]},\n\n\t\t// Allow users in "group:example" to access "tag:example", but only from\n\t\t// devices that are running macOS and have enabled Tailscale client auto-updating.\n\t\t// {"action": "accept", "src": ["group:example"], "dst": ["tag:example:*"], "srcPosture":["posture:autoUpdateMac"]},\n\t],\n'})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://tailscale.com/kb/1393/access-control",children:"ACL docs"})}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"ssh",children:"SSH"}),"\n",(0,a.jsx)(s.p,{children:"Tailscale allows users to SSH into any of their own devices but you can extend this out to allow groups, and users to SSH to tagged devices. This is why we were able to SSH into the EC2 instance because we own it."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:'// Define users and devices that can use Tailscale SSH.\n\t"ssh": [\n\t\t// Allow all users to SSH into their own devices in check mode.\n\t\t// Comment this section out if you want to define specific restrictions.\n\t\t{\n\t\t\t"action": "check",\n\t\t\t"src":    ["autogroup:member"],\n\t\t\t"dst":    ["autogroup:self"],\n\t\t\t"users":  ["autogroup:nonroot", "root"],\n\t\t},\n\t],\n\n'})}),"\n",(0,a.jsx)(s.admonition,{type:"info",children:(0,a.jsx)(s.p,{children:"What happens if we comment out the SSH block while we are SSH'ed into the EC2 instance?"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://tailscale.com/kb/1193/tailscale-ssh",children:"SSH docs"})}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"tests",children:"Tests"}),"\n",(0,a.jsx)(s.p,{children:"Tests are powerful assertions that can be utilized to verify ACL permissions. If an assertion fails, then the ACL will not save and will need to double-check and verify that it is accurate. One of the tailscale production best practices is to utilize ACL tests to help secure and verify your ACLs."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:'\t// Test access rules every time they\'re saved.\n\t "tests": [\n\t  \t{\n\t  \t\t"src": "alice@example.com",\n\t  \t\t"accept": ["tag:example"],\n\t  \t\t"deny": ["100.101.102.103:443"],\n\t  \t},\n\t ],\n'})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://tailscale.com/kb/1337/acl-syntax#tests",children:"ACL Tests docs"})}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"acl-documentation-and-examples",children:"ACL Documentation and Examples"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://https://tailscale.com/kb/1018/acls/",children:"Manage Permissions with ACLs"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://https://tailscale.com/kb/1337/acl-syntax#groups",children:"ACL Groups reference "})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://tailscale.com/kb/1337/acl-syntax",children:"ACL Syntax"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://tailscale.com/kb/1246/tailscale-ssh-session-recording",children:"SSH Recording"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},2372:(e,s,t)=>{t.d(s,{A:()=>n});const n=t.p+"assets/images/tailscale-acls-1-f272a5a010c5d9483c35df8581a8e597.png"},8453:(e,s,t)=>{t.d(s,{R:()=>o,x:()=>l});var n=t(6540);const a={},i=n.createContext(a);function o(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);