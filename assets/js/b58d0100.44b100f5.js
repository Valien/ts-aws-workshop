"use strict";(self.webpackChunkts_aws_workshop=self.webpackChunkts_aws_workshop||[]).push([[29],{9998:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"tutorial-basics/access-vm","title":"Access with Tailscale","description":"Now that the VM is built and connected to your Tailnet. Let\'s look at it in detail and access it via SSH!","source":"@site/docs/tutorial-basics/access-vm.mdx","sourceDirName":"tutorial-basics","slug":"/tutorial-basics/access-vm","permalink":"/ts-aws-workshop/docs/tutorial-basics/access-vm","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Creating a VM in AWS","permalink":"/ts-aws-workshop/docs/tutorial-basics/creating-vm"},"next":{"title":"ACL\'s!","permalink":"/ts-aws-workshop/docs/tutorial-basics/acls"}}');var n=s(4848),a=s(8453);const l={sidebar_position:5},o="Access with Tailscale",c={},d=[{value:"Machine details",id:"machine-details",level:2},{value:"Approve Exit node",id:"approve-exit-node",level:3},{value:"Tailscale SSH",id:"tailscale-ssh",level:2},{value:"Enable IP Forwarding",id:"enable-ip-forwarding",level:2},{value:"Test exit node",id:"test-exit-node",level:2}];function r(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"access-with-tailscale",children:"Access with Tailscale"})}),"\n",(0,n.jsx)(t.p,{children:"Now that the VM is built and connected to your Tailnet. Let's look at it in detail and access it via SSH!"}),"\n",(0,n.jsx)(t.h2,{id:"machine-details",children:"Machine details"}),"\n",(0,n.jsx)(t.p,{children:"The following screenshot is typical in what you will see when you look into the details of any tailnet device."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"VM Details",src:s(4200).A+"",width:"1195",height:"1337"})}),"\n",(0,n.jsxs)(t.p,{children:["Notice that the ",(0,n.jsx)(t.code,{children:"Exit Node"})," has a ",(0,n.jsx)(t.code,{children:"Awaiting approval"})," message? Just because we set the flag to enable this node to be an exit node we still need to approve it from the admin console."]}),"\n",(0,n.jsx)(t.h3,{id:"approve-exit-node",children:"Approve Exit node"}),"\n",(0,n.jsxs)(t.p,{children:["Go ahead and click the ",(0,n.jsx)(t.code,{children:"Edit"})," link and it will pop open a small window with some details. You'll want to check the ",(0,n.jsx)(t.code,{children:"Use as exit node"})," option and then hit ",(0,n.jsx)(t.code,{children:"Save"}),"."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"VM Details",src:s(8691).A+"",width:"626",height:"576"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"VM Details",src:s(9834).A+"",width:"509",height:"466"})}),"\n",(0,n.jsx)(t.h2,{id:"tailscale-ssh",children:"Tailscale SSH"}),"\n",(0,n.jsxs)(t.p,{children:["Before we can set up IP Forwarding on this box we'll need to SSH into it. Because we used Cloud Formation and set the tailscale flag - ",(0,n.jsx)(t.code,{children:"--ssh"})," that means we'll be able to leverage\nTailscale to SSH into this VM without having to use any PKI infrastructure. Tailscale handles all the SSH key generation and expiration. Pretty cool eh?"]}),"\n",(0,n.jsxs)(t.p,{children:["You can see our full docs here - ",(0,n.jsx)(t.a,{href:"https://tailscale.com/kb/1193/tailscale-ssh",children:"https://tailscale.com/kb/1193/tailscale-ssh"})]}),"\n",(0,n.jsx)(t.p,{children:"If you look at your Machine details you will see that there is an SSH status tag listed."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"SSH Details",src:s(9637).A+"",width:"405",height:"145"})}),"\n",(0,n.jsx)(t.p,{children:"This means that we can SSH into this VM if we have the right ACL's set. In this case  we'll be able to SSH because the default Tailscale ACL does allow users to SSH\ninto devices they own.  We'll cover more about ACL's in the next section."}),"\n",(0,n.jsx)(t.p,{children:"There are 2 ways to SSH into this VM from the Tailscale perspective:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"You can use the web-based SSH option"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"SSH Details",src:s(3886).A+"",width:"862",height:"101"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"VM Details",src:s(6024).A+"",width:"1143",height:"218"})}),"\n",(0,n.jsxs)(t.ol,{start:"2",children:["\n",(0,n.jsx)(t.li,{children:"Use your local CLI and favorite terminal SSH tool"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"For today's workshop, let's stick with the web-based SSH option."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Go ahead and click the ",(0,n.jsx)(t.strong,{children:"SSH to machine..."})," button. You'll get a pop-up asking for more details."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Click the drop-down that shows ",(0,n.jsx)(t.code,{children:"root"})," and select ",(0,n.jsx)(t.code,{children:"other"}),". In the text box put in ",(0,n.jsx)(t.code,{children:"ubuntu"})," as the user. Since this is an Ubuntu VM we'll need to SSH in as the ",(0,n.jsx)(t.code,{children:"ubuntu"})," user instead of the ",(0,n.jsx)(t.code,{children:"root"})," user."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"SSH Details",src:s(6760).A+"",width:"532",height:"359"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Click ",(0,n.jsx)(t.code,{children:"SSH"})," next"]}),"\n"]}),"\n",(0,n.jsx)(t.admonition,{type:"info",children:(0,n.jsx)(t.p,{children:"Most likely you will be prompted to re-authenticate to your identity provider. Go ahead and sign in again with the same user you are signed into the taiilnet as. This is a security\nfeature of Tailscale to verify a users identity before allowing them to access the device itself"})}),"\n",(0,n.jsx)(t.p,{children:"After a few seconds you'll be dropped into a web-based SSH terminal!"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"SSH Details",src:s(6977).A+"",width:"832",height:"547"})}),"\n",(0,n.jsx)(t.p,{children:"All based on your IdP identity and not using any public/private keys!"}),"\n",(0,n.jsx)(t.h2,{id:"enable-ip-forwarding",children:"Enable IP Forwarding"}),"\n",(0,n.jsxs)(t.p,{children:["Now that we're on the box let's setup IP forwarding. This is an Ubuntu VM so it will need the ",(0,n.jsx)(t.code,{children:"conf"})," set in it's ",(0,n.jsx)(t.code,{children:"/etc/sysctl.d"})," directory."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Copy the following code block:"}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"echo 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.d/99-tailscale.conf\necho 'net.ipv6.conf.all.forwarding = 1' | sudo tee -a /etc/sysctl.d/99-tailscale.conf\nsudo sysctl -p /etc/sysctl.d/99-tailscale.conf\n"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"In your web-terminal, paste the block and hit enter."}),"\n",(0,n.jsx)(t.li,{children:"You can verify it wrote the file by running the following:"}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"cat /etc/sysctl.d/99-tailscale.conf\n"})}),"\n",(0,n.jsx)(t.p,{children:"It will return the contents we just pasted."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Go ahead and exit out of the web-terminal"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Almost there! We need to do 1 more step before we can use this as an Exit node and that is to enable IP Forwarding for this Linux VM."}),"\n",(0,n.jsxs)(t.p,{children:["Here is our documentation page  - ",(0,n.jsx)(t.a,{href:"https://tailscale.com/kb/1103/exit-nodes?tab=linux",children:"https://tailscale.com/kb/1103/exit-nodes?tab=linux"})," and we'll want to scroll down until we get to the ",(0,n.jsx)(t.strong,{children:"Advertise a device as an exit node"})," section."]}),"\n",(0,n.jsx)(t.p,{children:"TODO:-- the CF template doesn't set this so you need to SSH and set the forwarding before Exit node traffic will route."}),"\n",(0,n.jsx)(t.h2,{id:"test-exit-node",children:"Test exit node"}),"\n",(0,n.jsx)(t.p,{children:"Now that the Exit node has been approved you can access it from your desktop client:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"VM Details",src:s(2969).A+"",width:"528",height:"358"})}),"\n",(0,n.jsx)(t.p,{children:"When you are successfully connected it will look like this:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"VM Details",src:s(2258).A+"",width:"537",height:"348"})}),"\n",(0,n.jsx)(t.p,{children:"Notice the little arrow? That shows your device is using the Exit node for all internet traffic."}),"\n",(0,n.jsx)(t.p,{children:"Now visit your favorite IP check site and verify your public IP:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"http://www.ipchicken.com",children:"www.ipchicken.com"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"http://www.whatismyipaddress.com",children:"www.whatismyipaddress.com"})}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"You should see the Public IP address of the AWS EC2 instance that is shown in the Machine details page."}),"\n",(0,n.jsx)(t.p,{children:"By default Tailscale operates as a split-tunnel network. So non-tailscale traffic is routed through your normal ISP but when you turn on the Exit node functionality it will operate\nas a full-tunnel network and all traffic will route through that exit node."})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(r,{...e})}):r(e)}},2969:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/exit-node-1-4a70c4c8d36ce5ea8d34b85ffc5d9f26.png"},2258:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/exit-node-2-d7fb282d949c2953dc164b713abfebda.png"},9637:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/tailscale-ssh-1-7c05b51fd2bd0d4d4f3e7c55da030610.png"},3886:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/tailscale-ssh-2-5b255932748e8f7ca3d479c4c450af28.png"},6760:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/tailscale-ssh-4-355c072c90f9bc734f5de7d2a7f2b31c.png"},6977:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/tailscale-ssh-5-da65809a065bee000a188c15411e67d6.png"},4200:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/vm-details-1-7a5be49a27e85ba5fd7fc6010712b7a4.png"},8691:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/vm-details-2-b1bcf7a35abd17d9242d018e6cd084ee.png"},9834:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/vm-details-3-8c084ac3d8b3529d15b5266b2d96979d.png"},6024:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/vm-ssh-1-1efd5866ef71769494311c2bc36c1fc2.png"},8453:(e,t,s)=>{s.d(t,{R:()=>l,x:()=>o});var i=s(6540);const n={},a=i.createContext(n);function l(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);